import{G as $,S as b,B as D}from"./runtime-BKONUYGa.js";let a=null;const l=document.getElementById("admin-login"),m=document.getElementById("admin-table"),p=document.querySelector("[data-table-body]"),T=document.querySelector("[data-summary]"),S=document.querySelector("[data-refresh]"),y=document.querySelector("[data-signout]"),u=document.querySelector("[data-status]");window.handleCredentialResponse=t=>{a=t.credential,sessionStorage.setItem("timebank_admin_token",a),s("Signing you in…"),g()};d();const _=sessionStorage.getItem("timebank_admin_token");_&&(a=_,g());S&&S.addEventListener("click",()=>g());y&&y.addEventListener("click",()=>{sessionStorage.removeItem("timebank_admin_token"),a=null,m.classList.add("hidden"),l.classList.remove("hidden"),s("Signed out")});function d(){if(window.google&&google.accounts&&google.accounts.id){google.accounts.id.initialize({client_id:$,callback:handleCredentialResponse,auto_select:!1,use_fedcm_for_prompt:!0});const t=document.querySelector("[data-gsi-admin]");t&&google.accounts.id.renderButton(t,{type:"standard",size:"large",width:280,theme:"outline",text:"continue_with",shape:"pill",logo_alignment:"left"});return}d.attempts>30||(d.attempts+=1,setTimeout(d,250))}d.attempts=0;async function g(){if(!a){l.classList.remove("hidden"),m.classList.add("hidden");return}s("Loading data…");try{const r=await(await fetch(D,{method:"POST",body:JSON.stringify({action:"admin_list_joined_donations",sharedKey:b,credential:a}),headers:{"Content-Type":"text/plain;charset=utf-8"}})).text(),i=JSON.parse(r);if(!i.success)throw new Error(i.error||"Unknown error");N(i.rows||[],i.drive,i.generatedAt),l.classList.add("hidden"),m.classList.remove("hidden"),s("")}catch(t){console.error(t),s(t.message||"Failed to load"),/Access denied/i.test(t.message||"")&&(l.classList.remove("hidden"),m.classList.add("hidden"))}}function N(t,o,r){p.innerHTML="";const i=t.slice().sort((e,c)=>new Date(c.createdAt)-new Date(e.createdAt));i.forEach(e=>{const c=document.createElement("tr");c.innerHTML=`
      <td>${n(e.email)}</td>
      <td>${n(e.profile.name||"")}</td>
      <td>${n(e.profile.batch||"")}</td>
      <td>${n(e.profile.department||"")}</td>
      <td>${n(e.area||"")}</td>
      <td>${n(e.mode||"")}</td>
      <td>${n(e.hoursCommitment||"")}</td>
      <td>${n(e.focusContext||"")}</td>
      <td>${n(e.timezone||"")}</td>
      <td>${n(C(e.createdAt))}</td>
      <td>${n(e.cohort)}</td>
    `,p.appendChild(c)});const f=i.length,h=i.filter(e=>e.cohort==="registered").length,L=f-h,E=r?new Date(r):new Date;T.textContent=`${f} donations · ${h} approved · ${L} pending · Drive: ${o?.label||""} · Updated ${I(E)}`}function s(t){u&&(u.textContent=t,u.classList.toggle("hidden",!t))}function n(t){return String(t||"").replace(/[&<>"']/g,o=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[o])}function C(t){if(!t)return"";const o=new Date(t);return Number.isNaN(o.getTime())?String(t):o.toISOString().slice(0,10)}function I(t){if(!t)return"";const o=new Date(t);return Number.isNaN(o.getTime())?String(t):o.toISOString().replace("T"," ").slice(0,16)+" UTC"}
