(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(e){if(e.ep)return;e.ep=!0;const o=i(e);fetch(e.href,o)}})();const y="https://script.google.com/macros/s/AKfycbzxY9Q27j0hkv8et8ZnY_Rg639FjD2jtMFFdXyhOZ-EPqH9dCNWjSPUXjISQnTZ8AQ/exec",w="239868878252-db1evisitvh535amajkvubl22kp0jcdm.apps.googleusercontent.com",_="62D8EAC6-9B68-4649-80EF-71FBC18D0D98";let l=null;const E=document.getElementById("view-landing"),d=document.getElementById("view-app"),b=document.querySelectorAll("[data-gsi-button]"),g=document.getElementById("busy-overlay"),f=document.getElementById("busy-message");document.querySelectorAll("[data-scroll]").forEach(t=>{t.addEventListener("click",n=>{const i=n.currentTarget.getAttribute("data-scroll"),r=document.querySelector(i);r&&r.scrollIntoView({behavior:"smooth"})})});window.handleCredentialResponse=t=>{l=t.credential,sessionStorage.setItem("timebank_token",l),a(!0,"Signing you in…"),u("login_and_fetch_view",{}).then(h).catch(p).finally(()=>a(!1))};c();const m=sessionStorage.getItem("timebank_token");m&&(l=m,a(!0,"Loading your dashboard…"),u("login_and_fetch_view",{}).then(h).catch(t=>{sessionStorage.removeItem("timebank_token"),p(t)}).finally(()=>a(!1)));function c(){if(window.google&&google.accounts&&google.accounts.id){google.accounts.id.initialize({client_id:w,callback:handleCredentialResponse,auto_select:!1,use_fedcm_for_prompt:!0}),b.forEach(t=>{google.accounts.id.renderButton(t,{type:"standard",size:"large",theme:"outline",text:"sign_in_with",shape:"pill",logo_alignment:"left"})});return}if(c.attempts>30){console.error("Google Identity Services failed to load.");return}c.attempts+=1,setTimeout(c,250)}c.attempts=0;function h(t){if(t.error)throw new Error(t.error);if(!t.html)throw new Error("Missing app view");E.classList.add("hidden"),d.classList.remove("hidden");const n=document.createRange();n.selectNode(document.body);const i=n.createContextualFragment(t.html);d.innerHTML="",d.appendChild(i),window.google=window.google||{},window.google.script={run:{withSuccessHandler:r=>({withFailureHandler:e=>({proxyApiCall:(o,s)=>{u(o,s).then(r).catch(e)}})})}}}async function u(t,n){const i={action:t,sharedKey:_,credential:l,...n},e=await(await fetch(y,{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"text/plain;charset=utf-8"}})).text();try{return JSON.parse(e)}catch{throw new Error("Server error: "+e.substring(0,100))}}function p(t){a(!1),alert(t.message||"Authentication failed")}function a(t,n){g&&(n&&f&&(f.textContent=n),g.classList.toggle("hidden",!t))}
