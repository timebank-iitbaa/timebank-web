(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function i(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(e){if(e.ep)return;e.ep=!0;const o=i(e);fetch(e.href,o)}})();const m="https://script.google.com/macros/s/AKfycbzxY9Q27j0hkv8et8ZnY_Rg639FjD2jtMFFdXyhOZ-EPqH9dCNWjSPUXjISQnTZ8AQ/exec",h="239868878252-db1evisitvh535amajkvubl22kp0jcdm.apps.googleusercontent.com",p="62D8EAC6-9B68-4649-80EF-71FBC18D0D98";let a=null;const w=document.getElementById("view-landing"),l=document.getElementById("view-app"),y=document.querySelectorAll("[data-gsi-button]");document.querySelectorAll("[data-scroll]").forEach(t=>{t.addEventListener("click",n=>{const i=n.currentTarget.getAttribute("data-scroll"),r=document.querySelector(i);r&&r.scrollIntoView({behavior:"smooth"})})});window.handleCredentialResponse=t=>{a=t.credential,sessionStorage.setItem("timebank_token",a),d("login_and_fetch_view",{}).then(g).catch(f)};s();const u=sessionStorage.getItem("timebank_token");u&&(a=u,d("login_and_fetch_view",{}).then(g).catch(t=>{sessionStorage.removeItem("timebank_token"),f(t)}));function s(){if(window.google&&google.accounts&&google.accounts.id){google.accounts.id.initialize({client_id:h,callback:handleCredentialResponse,auto_select:!1,use_fedcm_for_prompt:!0}),y.forEach(t=>{google.accounts.id.renderButton(t,{type:"standard",size:"large",theme:"outline",text:"sign_in_with",shape:"pill",logo_alignment:"left"})});return}if(s.attempts>30){console.error("Google Identity Services failed to load.");return}s.attempts+=1,setTimeout(s,250)}s.attempts=0;function g(t){if(t.error)throw new Error(t.error);if(!t.html)throw new Error("Missing app view");w.classList.add("hidden"),l.classList.remove("hidden");const n=document.createRange();n.selectNode(document.body);const i=n.createContextualFragment(t.html);l.innerHTML="",l.appendChild(i),window.google=window.google||{},window.google.script={run:{withSuccessHandler:r=>({withFailureHandler:e=>({proxyApiCall:(o,c)=>{d(o,c).then(r).catch(e)}})})}}}async function d(t,n){const i={action:t,sharedKey:p,credential:a,...n},e=await(await fetch(m,{method:"POST",body:JSON.stringify(i),headers:{"Content-Type":"text/plain;charset=utf-8"}})).text();try{return JSON.parse(e)}catch{throw new Error("Server error: "+e.substring(0,100))}}function f(t){alert(t.message||"Authentication failed")}
