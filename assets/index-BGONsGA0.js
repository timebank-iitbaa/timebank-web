(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function r(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(e){if(e.ep)return;e.ep=!0;const o=r(e);fetch(e.href,o)}})();const L=`<!-- @license lucide-static v0.562.0 - ISC -->
<svg
  class="lucide lucide-info"
  xmlns="http://www.w3.org/2000/svg"
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  stroke="currentColor"
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
>
  <circle cx="12" cy="12" r="10" />
  <path d="M12 16v-4" />
  <path d="M12 8h.01" />
</svg>
`,N="https://script.google.com/macros/s/AKfycbzxY9Q27j0hkv8et8ZnY_Rg639FjD2jtMFFdXyhOZ-EPqH9dCNWjSPUXjISQnTZ8AQ/exec",O="239868878252-db1evisitvh535amajkvubl22kp0jcdm.apps.googleusercontent.com",k="62D8EAC6-9B68-4649-80EF-71FBC18D0D98",T="iitbombay.org";let h=null;const B=document.getElementById("view-landing"),g=document.getElementById("view-app"),M=document.querySelectorAll("[data-gsi-button]"),b=document.querySelectorAll("[data-auth-hint]"),E=document.getElementById("busy-overlay"),C=document.getElementById("busy-message");document.querySelectorAll("[data-scroll]").forEach(t=>{t.addEventListener("click",n=>{const r=n.currentTarget.getAttribute("data-scroll"),i=document.querySelector(r);i&&i.scrollIntoView({behavior:"smooth"})})});window.handleCredentialResponse=t=>{h=t.credential,sessionStorage.setItem("timebank_token",h),m(!0,"Signing you in…"),f("login_and_fetch_view",{}).then(x).catch(I).finally(()=>m(!1))};p();H();const S=sessionStorage.getItem("timebank_token");S&&(h=S,m(!0,"Loading your dashboard…"),f("login_and_fetch_view",{}).then(x).catch(t=>{sessionStorage.removeItem("timebank_token"),I(t)}).finally(()=>m(!1)));function p(){if(window.google&&google.accounts&&google.accounts.id){google.accounts.id.initialize({client_id:O,callback:handleCredentialResponse,auto_select:!1,use_fedcm_for_prompt:!0}),M.forEach(t=>{google.accounts.id.renderButton(t,{type:"standard",size:"large",theme:"outline",text:"sign_in_with",shape:"pill",logo_alignment:"left"})});return}if(p.attempts>30){console.error("Google Identity Services failed to load.");return}p.attempts+=1,setTimeout(p,250)}p.attempts=0;function x(t){if(t.error)throw new Error(t.error);if(!t.html)throw new Error("Missing app view");B.classList.add("hidden"),g.classList.remove("hidden");const n=document.createRange();n.selectNode(document.body);const r=n.createContextualFragment(t.html);g.innerHTML="",g.appendChild(r),window.google=window.google||{},window.google.script={run:{withSuccessHandler:i=>({withFailureHandler:e=>({proxyApiCall:(o,a)=>{f(o,a).then(i).catch(e)}})})}}}async function f(t,n){const r={action:t,sharedKey:k,credential:h,...n},e=await(await fetch(N,{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"text/plain;charset=utf-8"}})).text();try{return JSON.parse(e)}catch{throw new Error("Server error: "+e.substring(0,100))}}function I(t){m(!1),alert(t.message||"Authentication failed")}function m(t,n){E&&(n&&C&&(C.textContent=n),E.classList.toggle("hidden",!t))}function H(){if(!b.length)return;const t=String(T).split(",").map(e=>e.trim()).filter(Boolean),n="Google Workspace sign-in. IITB alumni domains are approved instantly.",r="Sign in securely with your Google Workspace account — we never see your password.",i="If your email is from an approved IITB alumni domain, you can start immediately. Other Google accounts are welcome too and will be reviewed before activation.";b.forEach((e,o)=>{e.innerHTML="";const a=document.createElement("span");a.className="auth-hint-text",a.textContent=n;const c=document.createElement("button");c.type="button",c.className="auth-hint-button",c.setAttribute("aria-expanded","false"),c.setAttribute("aria-label","More about sign-in and approval"),c.innerHTML=L;const d=document.createElement("div");d.className="auth-popover hidden",d.setAttribute("role","dialog");const l=document.createElement("div");l.className="auth-popover-body";const y=document.createElement("p");y.textContent=r;const v=document.createElement("p");if(v.textContent=i,l.appendChild(y),l.appendChild(v),t.length===1){const s=document.createElement("p");s.className="auth-domain",s.textContent="Approved domain: "+t[0],l.appendChild(s)}if(t.length>1){const s=document.createElement("p");s.className="auth-domain",s.textContent="Approved domains:";const u=document.createElement("ul");u.className="auth-domain-list",t.forEach(_=>{const w=document.createElement("li");w.textContent=_,u.appendChild(w)}),l.appendChild(s),l.appendChild(u)}d.appendChild(l),c.addEventListener("click",s=>{s.stopPropagation();const u=!d.classList.contains("hidden");A(),u||(d.classList.remove("hidden"),c.setAttribute("aria-expanded","true"))}),e.appendChild(a),e.appendChild(c),e.appendChild(d)}),document.addEventListener("click",e=>{e.target.closest(".auth-hint")||A()})}function A(){document.querySelectorAll(".auth-popover").forEach(t=>{t.classList.add("hidden")}),document.querySelectorAll(".auth-hint-button").forEach(t=>{t.setAttribute("aria-expanded","false")})}
